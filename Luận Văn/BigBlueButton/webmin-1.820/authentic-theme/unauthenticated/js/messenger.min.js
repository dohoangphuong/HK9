/*! messenger 1.4.1 */
(function(){var b,a=window.Messenger;b=window.Messenger=function(){return b._call.apply(this,arguments)},window.Messenger.noConflict=function(){return window.Messenger=a,b}})(),window.Messenger._=function(){if(window._){return window._}var q=Array.prototype,y=Object.prototype,g=Function.prototype,z=(q.push,q.slice),b=(q.concat,y.toString);y.hasOwnProperty;var f=q.forEach,k=(q.map,q.reduce,q.reduceRight,q.filter),w=(q.every,q.some,q.indexOf,q.lastIndexOf,Array.isArray,Object.keys),j=g.bind,x={},v={},m=x.each=x.forEach=function(o,c,p){if(null!=o){if(f&&o.forEach===f){o.forEach(c,p)}else{if(o.length===+o.length){for(var h=0,l=o.length;l>h;h++){if(c.call(p,o[h],h,o)===v){return}}}else{for(var a in o){if(x.has(o,a)&&c.call(p,o[a],a,o)===v){return}}}}}};x.result=function(c,a){if(null==c){return null}var h=c[a];return x.isFunction(h)?h.call(c):h},x.once=function(c){var a,h=!1;return function(){return h?a:(h=!0,a=c.apply(this,arguments),c=null,a)}};var d=0;return x.uniqueId=function(c){var a=++d+"";return c?c+a:a},x.filter=x.select=function(h,a,i){var c=[];return null==h?c:k&&h.filter===k?h.filter(a,i):(m(h,function(n,l,p){a.call(i,n,l,p)&&(c[c.length]=n)}),c)},m(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(c){return b.call(c)=="[object "+a+"]"}}),x.defaults=function(a){return m(z.call(arguments,1),function(c){if(c){for(var e in c){null==a[e]&&(a[e]=c[e])}}}),a},x.extend=function(a){return m(z.call(arguments,1),function(c){if(c){for(var e in c){a[e]=c[e]}}}),a},x.keys=w||function(c){if(c!==Object(c)){throw new TypeError("Invalid object")}var a=[];for(var h in c){x.has(c,h)&&(a[a.length]=h)}return a},x.bind=function(c,a){if(c.bind===j&&j){return j.apply(c,z.call(arguments,1))}var h=z.call(arguments,2);return function(){return c.apply(a,h.concat(z.call(arguments)))}},x.isObject=function(a){return a===Object(a)},x}(),window.Messenger.Events=function(){if(window.Backbone&&Backbone.Events){return Backbone.Events}var a=function(){var d=/\s+/,b=function(j,q,k,m){if(!k){return !0}if("object"==typeof k){for(var p in k){j[q].apply(j,[p,k[p]].concat(m))}}else{if(!d.test(k)){return !0}for(var h=k.split(d),g=0,e=h.length;e>g;g++){j[q].apply(j,[h[g]].concat(m))}}},f=function(j,g){var k,h=-1,i=j.length;switch(g.length){case 0:for(;i>++h;){(k=j[h]).callback.call(k.ctx)}return;case 1:for(;i>++h;){(k=j[h]).callback.call(k.ctx,g[0])}return;case 2:for(;i>++h;){(k=j[h]).callback.call(k.ctx,g[0],g[1])}return;case 3:for(;i>++h;){(k=j[h]).callback.call(k.ctx,g[0],g[1],g[2])}return;default:for(;i>++h;){(k=j[h]).callback.apply(k.ctx,g)}}},c={on:function(i,j,g){if(!b(this,"on",i,[j,g])||!j){return this}this._events||(this._events={});var h=this._events[i]||(this._events[i]=[]);return h.push({callback:j,context:g,ctx:g||this}),this},once:function(i,k,g){if(!b(this,"once",i,[k,g])||!k){return this}var h=this,j=_.once(function(){h.off(i,j),k.apply(this,arguments)});return j._callback=k,this.on(i,j,g),this},off:function(t,k,y){var g,j,p,w,m,x,v,q;if(!this._events||!b(this,"off",t,[k,y])){return this}if(!t&&!k&&!y){return this._events={},this}for(w=t?[t]:_.keys(this._events),m=0,x=w.length;x>m;m++){if(t=w[m],g=this._events[t]){if(p=[],k||y){for(v=0,q=g.length;q>v;v++){j=g[v],(k&&k!==j.callback&&k!==j.callback._callback||y&&y!==j.context)&&p.push(j)}}this._events[t]=p}}return this},trigger:function(i){if(!this._events){return this}var g=Array.prototype.slice.call(arguments,1);if(!b(this,"trigger",i,g)){return this}var h=this._events[i],j=this._events.all;return h&&f(h,g),j&&f(j,arguments),this},listenTo:function(j,g,k){var h=this._listeners||(this._listeners={}),i=j._listenerId||(j._listenerId=_.uniqueId("l"));return h[i]=j,j.on(g,"object"==typeof g?this:k,this),this},stopListening:function(j,g,k){var h=this._listeners;if(h){if(j){j.off(g,"object"==typeof g?this:k,this),g||k||delete h[j._listenerId]}else{"object"==typeof g&&(k=this);for(var i in h){h[i].off(g,k,this)}this._listeners={}}return this}}};return c.bind=c.on,c.unbind=c.off,c};return a()}(),function(){var x,C,k,D,b,j,q,A,m,B,z,v={}.hasOwnProperty,g=function(d,a){function f(){this.constructor=d}for(var c in a){v.call(a,c)&&(d[c]=a[c])}return f.prototype=a.prototype,d.prototype=new f,d.__super__=a.prototype,d},y=[].slice,w=[].indexOf||function(c){for(var a=0,d=this.length;d>a;a++){if(a in this&&this[a]===c){return a}}return -1};x=jQuery,j=null!=(m=window._)?m:window.Messenger._,D=null!=(B="undefined"!=typeof Backbone&&null!==Backbone?Backbone.Events:void 0)?B:window.Messenger.Events,k=function(){function a(c){x.extend(this,D),j.isObject(c)&&(c.el&&this.setElement(c.el),this.model=c.model),this.initialize.apply(this,arguments)}return a.prototype.setElement=function(c){return this.$el=x(c),this.el=this.$el[0]},a.prototype.delegateEvents=function(u){var h,E,o,p,f,d,c;if(u||(u=j.result(this,"events"))){this.undelegateEvents(),h=/^(\S+)\s*(.*)$/,c=[];for(o in u){if(f=u[o],j.isFunction(f)||(f=this[u[o]]),!f){throw Error('Method "'+u[o]+'" does not exist')}p=o.match(h),E=p[1],d=p[2],f=j.bind(f,this),E+=".delegateEvents"+this.cid,""===d?c.push(this.jqon(E,f)):c.push(this.jqon(E,d,f))}return c}},a.prototype.jqon=function(f,c,h){var d;return null!=this.$el.on?(d=this.$el).on.apply(d,arguments):(null==h&&(h=c,c=void 0),null!=c?this.$el.delegate(c,f,h):this.$el.bind(f,h))},a.prototype.jqoff=function(d){var c;return null!=this.$el.off?(c=this.$el).off.apply(c,arguments):(this.$el.undelegate(),this.$el.unbind(d))},a.prototype.undelegateEvents=function(){return this.jqoff(".delegateEvents"+this.cid)},a.prototype.remove=function(){return this.undelegateEvents(),this.$el.remove()},a}(),q=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return g(c,a),c.prototype.defaults={hideAfter:10,scroll:!0,closeButtonText:"&times;"},c.prototype.initialize=function(d){return null==d&&(d={}),this.shown=!1,this.rendered=!1,this.messenger=d.messenger,this.options=x.extend({},this.options,d,this.defaults)},c.prototype.show=function(){var d;return this.rendered||this.render(),this.$message.removeClass("messenger-hidden"),d=this.shown,this.shown=!0,d?void 0:this.trigger("show")},c.prototype.hide=function(){var d;if(this.rendered){return this.$message.addClass("messenger-hidden"),d=this.shown,this.shown=!1,d?this.trigger("hide"):void 0}},c.prototype.cancel=function(){return this.hide()},c.prototype.update=function(d){var f,e=this;return j.isString(d)&&(d={message:d}),x.extend(this.options,d),this.lastUpdate=new Date,this.rendered=!1,this.events=null!=(f=this.options.events)?f:{},this.render(),this.actionsToEvents(),this.delegateEvents(),this.checkClickable(),this.options.hideAfter?(this.$message.addClass("messenger-will-hide-after"),null!=this._hideTimeout&&clearTimeout(this._hideTimeout),this._hideTimeout=setTimeout(function(){return e.hide()},1000*this.options.hideAfter)):this.$message.removeClass("messenger-will-hide-after"),this.options.hideOnNavigate?(this.$message.addClass("messenger-will-hide-on-navigate"),null!=("undefined"!=typeof Backbone&&null!==Backbone?Backbone.history:void 0)&&Backbone.history.on("route",function(){return e.hide()})):this.$message.removeClass("messenger-will-hide-on-navigate"),this.trigger("update",this)},c.prototype.scrollTo=function(){return this.options.scroll?x.scrollTo(this.$el,{duration:400,offset:{left:0,top:-20}}):void 0},c.prototype.timeSinceUpdate=function(){return this.lastUpdate?new Date-this.lastUpdate:null},c.prototype.actionsToEvents=function(){var i,d,l,f,h=this;l=this.options.actions,f=[];for(d in l){i=l[d],f.push(this.events['click [data-action="'+d+'"] a']=function(n){return function(e){return e.preventDefault(),e.stopPropagation(),h.trigger("action:"+d,n,e),n.action.call(h,e,h)}}(i))}return f},c.prototype.checkClickable=function(){var h,d,i,f;i=this.events,f=[];for(d in i){h=i[d],"click"===d?f.push(this.$message.addClass("messenger-clickable")):f.push(void 0)}return f},c.prototype.undelegateEvents=function(){var d;return c.__super__.undelegateEvents.apply(this,arguments),null!=(d=this.$message)?d.removeClass("messenger-clickable"):void 0},c.prototype.parseActions=function(){var e,p,f,h,l,d;p=[],l=this.options.actions;for(h in l){e=l[h],f=x.extend({},e),f.name=h,null==(d=f.label)&&(f.label=h),p.push(f)}return p},c.prototype.template=function(L){var E,M,d,f,G,J,F,K,I,H,e=this;for(G=x("<div class='messenger-message message alert "+L.type+" message-"+L.type+" alert-"+L.type+"'>"),L.showCloseButton&&(d=x('<button type="button" class="messenger-close" data-dismiss="alert">'),d.html(L.closeButtonText),d.click(function(){return e.cancel(),!0}),G.append(d)),J=x('<div class="messenger-message-inner">'+L.message+"</div>"),G.append(J),L.actions.length&&(M=x('<div class="messenger-actions">')),H=L.actions,K=0,I=H.length;I>K;K++){F=H[K],E=x("<span>"),E.attr("data-action",""+F.name),f=x("<a>"),f.html(F.label),E.append(x('<span class="messenger-phrase">')),E.append(f),M.append(E)}return G.append(M),G},c.prototype.render=function(){var d;if(!this.rendered){return this._hasSlot||(this.setElement(this.messenger._reserveMessageSlot(this)),this._hasSlot=!0),d=x.extend({},this.options,{actions:this.parseActions()}),this.$message=x(this.template(d)),this.$el.html(this.$message),this.shown=!0,this.rendered=!0,this.trigger("render")}},c}(k),b=function(c){function a(){return a.__super__.constructor.apply(this,arguments)}return g(a,c),a.prototype.initialize=function(){return a.__super__.initialize.apply(this,arguments),this._timers={}},a.prototype.cancel=function(){return this.clearTimers(),this.hide(),null!=this._actionInstance&&null!=this._actionInstance.abort?this._actionInstance.abort():void 0},a.prototype.clearTimers=function(){var h,d,i,f;i=this._timers;for(h in i){d=i[h],clearTimeout(d)}return this._timers={},null!=(f=this.$message)?f.removeClass("messenger-retry-soon messenger-retry-later"):void 0},a.prototype.render=function(){var h,i,d,f;a.__super__.render.apply(this,arguments),this.clearTimers(),d=this.options.actions,f=[];for(i in d){h=d[i],h.auto?f.push(this.startCountdown(i,h)):f.push(void 0)}return f},a.prototype.renderPhrase=function(f,d){var h;return h=f.phrase.replace("TIME",this.formatTime(d))},a.prototype.formatTime=function(f){var d;return d=function(i,h){return i=Math.floor(i),1!==i&&(h+="s"),"in "+i+" "+h},0===Math.floor(f)?"now...":60>f?d(f,"second"):(f/=60,60>f?d(f,"minute"):(f/=60,d(f,"hour")))},a.prototype.startCountdown=function(p,f){var E,h,l,u,d=this;if(null==this._timers[p]){return E=this.$message.find("[data-action='"+p+"'] .messenger-phrase"),h=null!=(u=f.delay)?u:3,10>=h?(this.$message.removeClass("messenger-retry-later"),this.$message.addClass("messenger-retry-soon")):(this.$message.removeClass("messenger-retry-soon"),this.$message.addClass("messenger-retry-later")),l=function(){var e;return E.text(d.renderPhrase(f,h)),h>0?(e=Math.min(h,1),h-=e,d._timers[p]=setTimeout(l,1000*e)):(d.$message.removeClass("messenger-retry-soon messenger-retry-later"),delete d._timers[p],f.action())},l()}},a}(q),A=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return g(c,a),c.prototype.tagName="ul",c.prototype.className="messenger",c.prototype.messageDefaults={type:"info"},c.prototype.initialize=function(d){return this.options=null!=d?d:{},this.history=[],this.messageDefaults=x.extend({},this.messageDefaults,this.options.messageDefaults)},c.prototype.render=function(){return this.updateMessageSlotClasses()},c.prototype.findById=function(d){return j.filter(this.history,function(e){return e.msg.options.id===d})},c.prototype._reserveMessageSlot=function(d){var h,e,f=this;for(h=x("<li>"),h.addClass("messenger-message-slot"),this.$el.prepend(h),this.history.push({msg:d,$slot:h}),this._enforceIdConstraint(d),d.on("update",function(){return f._enforceIdConstraint(d)});this.options.maxMessages&&this.history.length>this.options.maxMessages;){e=this.history.shift(),e.msg.remove(),e.$slot.remove()}return h},c.prototype._enforceIdConstraint=function(i){var d,p,f,h,l;if(null!=i.options.id){for(l=this.history,p=0,f=l.length;f>p;p++){if(d=l[p],h=d.msg,null!=h.options.id&&h.options.id===i.options.id&&i!==h){if(i.options.singleton){return i.hide(),void 0}h.hide()}}}},c.prototype.newMessage=function(i){var f,p,h,l,d=this;return null==i&&(i={}),i.messenger=this,q=null!=(p=null!=(h=Messenger.themes[null!=(l=i.theme)?l:this.options.theme])?h.Message:void 0)?p:b,f=new q(i),f.on("show",function(){return i.scrollTo&&"fixed"!==d.$el.css("position")?f.scrollTo():void 0}),f.on("hide show render",this.updateMessageSlotClasses,this),f},c.prototype.updateMessageSlotClasses=function(){var p,f,E,h,l,u,d;for(h=!0,f=null,p=!1,d=this.history,l=0,u=d.length;u>l;l++){E=d[l],E.$slot.removeClass("messenger-first messenger-last messenger-shown"),E.msg.shown&&E.msg.rendered&&(E.$slot.addClass("messenger-shown"),p=!0,f=E,h&&(h=!1,E.$slot.addClass("messenger-first")))}return null!=f&&f.$slot.addClass("messenger-last"),this.$el[""+(p?"remove":"add")+"Class"]("messenger-empty")},c.prototype.hideAll=function(){var i,d,l,f,h;for(f=this.history,h=[],d=0,l=f.length;l>d;d++){i=f[d],h.push(i.msg.hide())}return h},c.prototype.post=function(d){var e;return j.isString(d)&&(d={message:d}),d=x.extend(!0,{},this.messageDefaults,d),e=this.newMessage(d),e.update(d),e},c}(k),C=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return g(c,a),c.prototype.doDefaults={progressMessage:null,successMessage:null,errorMessage:"Error connecting to the server.",showSuccessWithoutError:!0,retry:{auto:!0,allow:!0},action:x.ajax},c.prototype.hookBackboneAjax=function(d){var f,e=this;if(null==d&&(d={}),null==window.Backbone){throw"Expected Backbone to be defined"}return d=j.defaults(d,{id:"BACKBONE_ACTION",errorMessage:!1,successMessage:"Request completed successfully.",showSuccessWithoutError:!1}),f=function(h){var i;return i=j.extend({},d,h.messenger),e["do"](i,h)},null!=Backbone.ajax?(Backbone.ajax._withoutMessenger&&(Backbone.ajax=Backbone.ajax._withoutMessenger),(null==d.action||d.action===this.doDefaults.action)&&(d.action=Backbone.ajax),f._withoutMessenger=Backbone.ajax,Backbone.ajax=f):Backbone.sync=j.wrap(Backbone.sync,function(){var h,i,l;return l=arguments[0],h=arguments.length>=2?y.call(arguments,1):[],i=x.ajax,x.ajax=f,l.call.apply(l,[this].concat(y.call(h))),x.ajax=i})},c.prototype._getHandlerResponse=function(d){return d===!1?!1:d===!0||null==d?!0:d},c.prototype._parseEvents=function(u){var h,F,l,p,E,f,d;null==u&&(u={}),E={};for(p in u){l=u[p],F=p.indexOf(" "),f=p.substring(0,F),h=p.substring(F+1),null==(d=E[f])&&(E[f]={}),E[f][h]=l}return E},c.prototype._normalizeResponse=function(){var p,h,u,l,o,f,d;for(u=arguments.length>=1?y.call(arguments,0):[],l=null,o=null,p=null,f=0,d=u.length;d>f;f++){h=u[f],"success"===h||"timeout"===h||"abort"===h?l=h:null!=(null!=h?h.readyState:void 0)&&null!=(null!=h?h.responseText:void 0)?o=h:j.isObject(h)&&(p=h)}return[l,p,o]},c.prototype.run=function(){var K,f,L,d,E,I,o,J,H,F,e,G=this;if(I=arguments[0],H=arguments[1],K=arguments.length>=3?y.call(arguments,2):[],null==H&&(H={}),I=x.extend(!0,{},this.messageDefaults,this.doDefaults,null!=I?I:{}),f=this._parseEvents(I.events),L=function(i,h){var l;return l=I[i+"Message"],j.isFunction(l)?l.call(G,i,h):l},o=null!=(e=I.messageInstance)?e:this.newMessage(I),null!=I.id&&(o.options.id=I.id),null!=I.progressMessage&&o.update(x.extend({},I,{message:L("progress",null),type:"info"})),E={},j.each(["error","success"],function(i){var h;return h=H[i],E[i]=function(){var u,N,n,r,Q,U,T,S,P,R,O,l,s,t,V;return U=arguments.length>=1?y.call(arguments,0):[],P=G._normalizeResponse.apply(G,U),Q=P[0],u=P[1],S=P[2],"success"===i&&null==o.errorCount&&I.showSuccessWithoutError===!1&&(I.successMessage=null),"error"===i&&(null==(R=I.errorCount)&&(I.errorCount=0),I.errorCount+=1),n=I.returnsPromise?U[0]:"function"==typeof h?h.apply(null,U):void 0,T=G._getHandlerResponse(n),j.isString(T)&&(T={message:T}),"error"!==i||0!==(null!=S?S.status:void 0)&&"abort"!==Q?"error"===i&&null!=I.ignoredErrorCodes&&(O=null!=S?S.status:void 0,w.call(I.ignoredErrorCodes,O)>=0)?(o.hide(),void 0):(N={message:L(i,S),type:i,events:null!=(l=f[i])?l:{},hideOnNavigate:"success"===i},r=x.extend({},I,N,T),"number"==typeof(null!=(s=r.retry)?s.allow:void 0)&&r.retry.allow--,"error"===i&&(null!=S?S.status:void 0)>=500&&(null!=(t=r.retry)?t.allow:void 0)?(null==r.retry.delay&&(r.retry.delay=4>r.errorCount?10:300),r.hideAfter&&(null==(V=r._hideAfter)&&(r._hideAfter=r.hideAfter),r.hideAfter=r._hideAfter+r.retry.delay),r._retryActions=!0,r.actions={retry:{label:"retry now",phrase:"Retrying TIME",auto:r.retry.auto,delay:r.retry.delay,action:function(){return r.messageInstance=o,setTimeout(function(){return G["do"].apply(G,[r,H].concat(y.call(K)))},0)}},cancel:{action:function(){return o.cancel()}}}):r._retryActions&&(delete r.actions.retry,delete r.actions.cancel,delete I._retryActions),o.update(r),T&&r.message?(Messenger(j.extend({},G.options,{instance:G})),o.show()):o.hide()):(o.hide(),void 0)}}),!I.returnsPromise){for(F in E){d=E[F],J=H[F],H[F]=d}}return o._actionInstance=I.action.apply(I,[H].concat(y.call(K))),I.returnsPromise&&o._actionInstance.then(E.success,E.error),o},c.prototype["do"]=c.prototype.run,c.prototype.ajax=function(){var d,e;return e=arguments[0],d=arguments.length>=2?y.call(arguments,1):[],e.action=x.ajax,this.run.apply(this,[e].concat(y.call(d)))},c.prototype.expectPromise=function(f,d){return d=j.extend({},d,{action:f,returnsPromise:!0}),this.run(d)},c.prototype.error=function(d){return null==d&&(d={}),"string"==typeof d&&(d={message:d}),d.type="error",this.post(d)},c.prototype.info=function(d){return null==d&&(d={}),"string"==typeof d&&(d={message:d}),d.type="info",this.post(d)},c.prototype.success=function(d){return null==d&&(d={}),"string"==typeof d&&(d={message:d}),d.type="success",this.post(d)},c}(A),x.fn.messenger=function(){var E,o,p,e,a,d,t,f;return p=arguments[0],o=arguments.length>=2?y.call(arguments,1):[],null==p&&(p={}),E=this,null!=p&&j.isString(p)?(f=E.data("messenger"))[p].apply(f,o):(a=p,null==E.data("messenger")&&(A=null!=(d=null!=(t=Messenger.themes[a.theme])?t.Messenger:void 0)?d:C,E.data("messenger",e=new A(x.extend({el:E},a))),e.render()),E.data("messenger"))},window.Messenger._call=function(L){var E,M,d,f,G,J,F,K,I,H,e;if(J={extraClasses:"messenger-fixed messenger-on-bottom messenger-on-right",theme:"future",maxMessages:9,parentLocations:["body"]},L=x.extend(J,x._messengerDefaults,Messenger.options,L),null!=L.theme&&(L.extraClasses+=" messenger-theme-"+L.theme),F=L.instance||Messenger.instance,null==L.instance){for(I=L.parentLocations,M=null,d=null,H=0,e=I.length;e>H;H++){if(K=I[H],M=x(K),M.length){f=K;break}}F?x(F._location).is(x(f))||(F.$el.detach(),M.prepend(F.$el)):(E=x("<ul>"),M.prepend(E),F=E.messenger(L),F._location=f,Messenger.instance=F)}return null!=F._addedClasses&&F.$el.removeClass(F._addedClasses),F.$el.addClass(G=""+F.className+" "+L.extraClasses),F._addedClasses=G,F},x.extend(Messenger,{Message:b,Messenger:C,themes:null!=(z=Messenger.themes)?z:{}}),x.globalMessenger=window.Messenger=Messenger}.call(this);