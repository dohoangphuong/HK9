(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../htmlmixed/htmlmixed"],a)}else{a(CodeMirror)}}})(function(a){var b=["template","literal","msg","fallbackmsg","let","if","elseif","else","switch","case","default","foreach","ifempty","for","call","param","deltemplate","delcall","log"];a.defineMode("soy",function(d){var c=a.getMode(d,"text/plain");var g={html:a.getMode(d,{name:"text/html",multilineTagIndentFactor:2,multilineTagIndentPastTag:false}),attributes:c,text:c,uri:c,css:a.getMode(d,"text/css"),js:a.getMode(d,{name:"text/javascript",statementIndent:2*d.indentUnit})};function e(h){return h[h.length-1]}function f(m,l,k){var i=m.string;var j=k.exec(i.substr(m.pos));if(j){m.string=i.substr(0,m.pos+j.index)}var h=m.hideFirstChars(l.indent,function(){return l.localMode.token(m,l.localState)});m.string=i;return h}return{startState:function(){return{kind:[],kindTag:[],soyState:[],indent:0,localMode:g.html,localState:a.startState(g.html)}},copyState:function(h){return{tag:h.tag,kind:h.kind.concat([]),kindTag:h.kindTag.concat([]),soyState:h.soyState.concat([]),indent:h.indent,localMode:h.localMode,localState:a.copyState(h.localMode,h.localState)}},token:function(k,j){var h;switch(e(j.soyState)){case"comment":if(k.match(/^.*?\*\//)){j.soyState.pop()}else{k.skipToEnd()}return"comment";case"variable":if(k.match(/^}/)){j.indent-=2*d.indentUnit;j.soyState.pop();return"variable-2"}k.next();return null;case"tag":if(k.match(/^\/?}/)){if(j.tag=="/template"||j.tag=="/deltemplate"){j.indent=0}else{j.indent-=(k.current()=="/}"||b.indexOf(j.tag)==-1?2:1)*d.indentUnit}j.soyState.pop();return"keyword"}else{if(k.match(/^([\w?]+)(?==)/)){if(k.current()=="kind"&&(h=k.match(/^="([^"]+)/,false))){var i=h[1];j.kind.push(i);j.kindTag.push(j.tag);j.localMode=g[i]||g.html;j.localState=a.startState(j.localMode)}return"attribute"}else{if(k.match(/^"/)){j.soyState.push("string");return"string"}}}k.next();return null;case"literal":if(k.match(/^(?=\{\/literal})/)){j.indent-=d.indentUnit;j.soyState.pop();return this.token(k,j)}return f(k,j,/\{\/literal}/);case"string":if(k.match(/^.*?"/)){j.soyState.pop()}else{k.skipToEnd()}return"string"}if(k.match(/^\/\*/)){j.soyState.push("comment");return"comment"}else{if(k.match(k.sol()?/^\s*\/\/.*/:/^\s+\/\/.*/)){return"comment"}else{if(k.match(/^\{\$[\w?]*/)){j.indent+=2*d.indentUnit;j.soyState.push("variable");return"variable-2"}else{if(k.match(/^\{literal}/)){j.indent+=d.indentUnit;j.soyState.push("literal");return"keyword"}else{if(h=k.match(/^\{([\/@\\]?[\w?]*)/)){if(h[1]!="/switch"){j.indent+=(/^(\/|(else|elseif|case|default)$)/.test(h[1])&&j.tag!="switch"?1:2)*d.indentUnit}j.tag=h[1];if(j.tag=="/"+e(j.kindTag)){j.kind.pop();j.kindTag.pop();j.localMode=g[e(j.kind)]||g.html;j.localState=a.startState(j.localMode)}j.soyState.push("tag");return"keyword"}}}}}return f(k,j,/\{|\s+\/\/|\/\*/)},indent:function(j,i){var h=j.indent,k=e(j.soyState);if(k=="comment"){return a.Pass}if(k=="literal"){if(/^\{\/literal}/.test(i)){h-=d.indentUnit}}else{if(/^\s*\{\/(template|deltemplate)\b/.test(i)){return 0}if(/^\{(\/|(fallbackmsg|elseif|else|ifempty)\b)/.test(i)){h-=d.indentUnit}if(j.tag!="switch"&&/^\{(case|default)\b/.test(i)){h-=d.indentUnit}if(/^\{\/switch\b/.test(i)){h-=d.indentUnit}}if(h&&j.localMode.indent){h+=j.localMode.indent(j.localState,i)}return h},innerMode:function(h){if(h.soyState.length&&e(h.soyState)!="literal"){return null}else{return{state:h.localState,mode:h.localMode}}},electricInput:/^\s*\{(\/|\/template|\/deltemplate|\/switch|fallbackmsg|elseif|else|case|default|ifempty|\/literal\})$/,lineComment:"//",blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",fold:"indent"}},"htmlmixed");a.registerHelper("hintWords","soy",b.concat(["delpackage","namespace","alias","print","css","debugger"]));a.defineMIME("text/x-soy","soy")});