(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../../addon/mode/overlay"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../htmlmixed/htmlmixed","../../addon/mode/overlay"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("django:inner",function(){var g=["block","endblock","for","endfor","true","false","loop","none","self","super","if","endif","as","else","import","with","endwith","without","context","ifequal","endifequal","ifnotequal","endifnotequal","extends","include","load","comment","endcomment","empty","url","static","trans","blocktrans","now","regroup","lorem","ifchanged","endifchanged","firstof","debug","cycle","csrf_token","autoescape","endautoescape","spaceless","ssi","templatetag","verbatim","endverbatim","widthratio"],b=["add","addslashes","capfirst","center","cut","date","default","default_if_none","dictsort","dictsortreversed","divisibleby","escape","escapejs","filesizeformat","first","floatformat","force_escape","get_digit","iriencode","join","last","length","length_is","linebreaks","linebreaksbr","linenumbers","ljust","lower","make_list","phone2numeric","pluralize","pprint","random","removetags","rjust","safe","safeseq","slice","slugify","stringformat","striptags","time","timesince","timeuntil","title","truncatechars","truncatechars_html","truncatewords","truncatewords_html","unordered_list","upper","urlencode","urlize","urlizetrunc","wordcount","wordwrap","yesno"],e=["==","!=","<",">","<=",">=","in","not","or","and"];g=new RegExp("^\\b("+g.join("|")+")\\b");b=new RegExp("^\\b("+b.join("|")+")\\b");e=new RegExp("^\\b("+e.join("|")+")\\b");function d(l,k){if(l.match("{{")){k.tokenize=h;return"tag"}else{if(l.match("{%")){k.tokenize=c;return"tag"}else{if(l.match("{#")){k.tokenize=i;return"comment"}}}while(l.next()!=null&&!l.match("{{",false)&&!l.match("{%",false)){}return null}function f(l,k){return function(o,n){if(!n.escapeNext&&o.eat(l)){n.tokenize=k}else{if(n.escapeNext){n.escapeNext=false}var m=o.next();if(m=="\\"){n.escapeNext=true}}return"string"}}function h(l,k){if(k.waitDot){k.waitDot=false;if(l.peek()!="."){return"null"}if(l.match(/\.\W+/)){return"error"}else{if(l.eat(".")){k.waitProperty=true;return"null"}else{throw Error("Unexpected error while waiting for property.")}}}if(k.waitPipe){k.waitPipe=false;if(l.peek()!="|"){return"null"}if(l.match(/\.\W+/)){return"error"}else{if(l.eat("|")){k.waitFilter=true;return"null"}else{throw Error("Unexpected error while waiting for filter.")}}}if(k.waitProperty){k.waitProperty=false;if(l.match(/\b(\w+)\b/)){k.waitDot=true;k.waitPipe=true;return"property"}}if(k.waitFilter){k.waitFilter=false;if(l.match(b)){return"variable-2"}}if(l.eatSpace()){k.waitProperty=false;return"null"}if(l.match(/\b\d+(\.\d+)?\b/)){return"number"}if(l.match("'")){k.tokenize=f("'",k.tokenize);return"string"}else{if(l.match('"')){k.tokenize=f('"',k.tokenize);return"string"}}if(l.match(/\b(\w+)\b/)&&!k.foundVariable){k.waitDot=true;k.waitPipe=true;return"variable"}if(l.match("}}")){k.waitProperty=null;k.waitFilter=null;k.waitDot=null;k.waitPipe=null;k.tokenize=d;return"tag"}l.next();return"null"}function c(m,l){if(l.waitDot){l.waitDot=false;if(m.peek()!="."){return"null"}if(m.match(/\.\W+/)){return"error"}else{if(m.eat(".")){l.waitProperty=true;return"null"}else{throw Error("Unexpected error while waiting for property.")}}}if(l.waitPipe){l.waitPipe=false;if(m.peek()!="|"){return"null"}if(m.match(/\.\W+/)){return"error"}else{if(m.eat("|")){l.waitFilter=true;return"null"}else{throw Error("Unexpected error while waiting for filter.")}}}if(l.waitProperty){l.waitProperty=false;if(m.match(/\b(\w+)\b/)){l.waitDot=true;l.waitPipe=true;return"property"}}if(l.waitFilter){l.waitFilter=false;if(m.match(b)){return"variable-2"}}if(m.eatSpace()){l.waitProperty=false;return"null"}if(m.match(/\b\d+(\.\d+)?\b/)){return"number"}if(m.match("'")){l.tokenize=f("'",l.tokenize);return"string"}else{if(m.match('"')){l.tokenize=f('"',l.tokenize);return"string"}}if(m.match(e)){return"operator"}var k=m.match(g);if(k){if(k[0]=="comment"){l.blockCommentTag=true}return"keyword"}if(m.match(/\b(\w+)\b/)){l.waitDot=true;l.waitPipe=true;return"variable"}if(m.match("%}")){l.waitProperty=null;l.waitFilter=null;l.waitDot=null;l.waitPipe=null;if(l.blockCommentTag){l.blockCommentTag=false;l.tokenize=j}else{l.tokenize=d}return"tag"}m.next();return"null"}function i(l,k){if(l.match("#}")){k.tokenize=d}return"comment"}function j(l,k){if(l.match(/\{%\s*endcomment\s*%\}/,false)){k.tokenize=c;l.match("{%");return"tag"}else{l.next();return"comment"}}return{startState:function(){return{tokenize:d}},token:function(l,k){return k.tokenize(l,k)},blockCommentStart:"{% comment %}",blockCommentEnd:"{% endcomment %}"}});a.defineMode("django",function(b){var d=a.getMode(b,"text/html");var c=a.getMode(b,"django:inner");return a.overlayMode(d,c)});a.defineMIME("text/x-django","django")});